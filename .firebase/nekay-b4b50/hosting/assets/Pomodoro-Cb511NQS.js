import{s as b,x as k,d as v,y as L,j as R,z as M,c as a,A as s,t as u,g as f,a as o,q as n,n as g,p as I,o as l}from"./app-K6xtmCpT.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";const D="/assets/melody3.gif",c=25*60,w=5*60,E=.5,N=3e4,y="pomodoro-state",P=b("pomodoro",{state:()=>({timeLeft:c,isRunning:!1,worker:null,stats:null,currentSession:null,error:null,isLoading:!1,mode:"work",lastSyncTime:Date.now()}),getters:{formattedTime:t=>{const i=Math.floor(t.timeLeft/60),r=t.timeLeft%60;return`${i}:${r.toString().padStart(2,"0")}`},formattedTotalTime:t=>t.stats?`${Math.floor(t.stats.totalFocusTime/60)} minutes`:"0 minutes",progress:t=>{const i=t.mode==="work"?c:w;return(i-t.timeLeft)/i*100}},actions:{async init(){try{this.isLoading=!0,this.error=null,this.worker=new Worker("/pomodoro-worker.js"),this.setupWorkerListeners();const t=localStorage.getItem(y);if(t){const{timeLeft:r,isRunning:h,mode:p}=JSON.parse(t);this.timeLeft=r,this.mode=p,h&&this.start()}document.addEventListener("visibilitychange",this.handleVisibilityChange),setInterval(this.syncTime,N);const i=await k.getItem("pomodoro","stats");if(i)this.stats=i;else{const r={id:"stats",completedSessions:0,totalFocusTime:0,lastModified:Date.now(),syncStatus:"pending"};await k.addItem("pomodoro",r),this.stats=r}"Notification"in window&&await Notification.requestPermission(),window.addEventListener("keydown",this.handleKeyPress)}catch{this.error="Failed to initialize Pomodoro timer"}finally{this.isLoading=!1}},setupWorkerListeners(){this.worker&&(this.worker.onmessage=t=>{const{type:i,timeLeft:r}=t.data;switch(i){case"TICK":this.timeLeft=r,this.saveState();break;case"COMPLETE":this.complete();break}})},handleVisibilityChange(){document.hidden?this.lastSyncTime=Date.now():this.syncTime()},syncTime(){!this.worker||!this.isRunning||(this.worker.postMessage({type:"SYNC",payload:{serverTime:this.lastSyncTime}}),this.lastSyncTime=Date.now())},start(){this.isRunning||!this.worker||(this.isRunning=!0,this.mode==="work"&&(this.currentSession={id:crypto.randomUUID(),startTime:Date.now(),endTime:0,duration:0,type:"work",completed:!1,lastModified:Date.now(),syncStatus:"pending"}),this.worker.postMessage({type:"START",payload:{timeLeft:this.timeLeft}}),this.saveState())},pause(){!this.isRunning||!this.worker||(this.isRunning=!1,this.worker.postMessage({type:"PAUSE"}),this.saveState())},reset(){if(!this.worker)return;this.pause();const t=this.mode==="work"?c:w;this.worker.postMessage({type:"RESET",payload:{duration:t}}),this.currentSession=null,this.saveState()},toggleMode(){this.pause(),this.mode=this.mode==="work"?"break":"work",this.timeLeft=this.mode==="work"?c:w,this.saveState()},saveState(){localStorage.setItem(y,JSON.stringify({timeLeft:this.timeLeft,isRunning:this.isRunning,mode:this.mode}))},async complete(){try{if(this.pause(),this.currentSession&&this.stats&&this.mode==="work"){this.currentSession.endTime=Date.now();const t=Math.floor((this.currentSession.endTime-this.currentSession.startTime)/1e3);this.currentSession.duration=t,this.currentSession.completed=!0,await k.addItem("pomodoro",this.currentSession),this.stats.completedSessions++,this.stats.totalFocusTime+=t,this.stats.lastModified=Date.now(),this.stats.syncStatus="pending",await k.updateItem("pomodoro","stats",this.stats)}this.mode=this.mode==="work"?"break":"work",this.timeLeft=this.mode==="work"?c:w,this.saveState();try{const t=new Audio("/notification.mp3");t.volume=E,await t.play()}catch{}"Notification"in window&&Notification.permission==="granted"&&new Notification(this.mode==="work"?"Break Time!":"Back to Work!",{body:this.mode==="work"?"Time to focus on your next task!":"Great job! Take a short break.",icon:"/favicon.ico"})}catch{this.error="Failed to save session"}},handleKeyPress(t){if(!(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement))switch(t.key.toLowerCase()){case" ":t.preventDefault(),this.isRunning?this.pause():this.start();break;case"r":t.preventDefault(),this.reset();break;case"b":t.preventDefault(),this.toggleMode();break}},dispose(){window.removeEventListener("keydown",this.handleKeyPress),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.worker&&(this.worker.terminate(),this.worker=null),this.pause()}}}),_={class:"pomodoro-container"},B={key:0,class:"error-message",role:"alert"},A={key:1,class:"loading-spinner",role:"status"},O={key:2,class:"timer-card"},K=["aria-label"],x={class:"timer-controls",role:"group","aria-label":"Timer controls"},F=["aria-label"],V={key:0,class:"stats-container",role:"region","aria-label":"Progress statistics"},W={class:"stats-content"},U={key:1,class:"dancing-melody",role:"status","aria-label":"Timer is running"},$=v({__name:"Pomodoro",setup(t){const i=P(),{isRunning:r,stats:h,error:p,isLoading:S,mode:d,progress:T}=L(i);return R(async()=>{await i.init()}),M(()=>{i.dispose()}),(z,e)=>(l(),a("div",_,[s(p)?(l(),a("div",B,u(s(p)),1)):f("v-if",!0),s(S)?(l(),a("div",A,e[4]||(e[4]=[o("span",{class:"sr-only"},"Loading...",-1),n(" Loading... ")]))):(l(),a("div",O,[o("div",{class:g(["mode-indicator",s(d)])},u(s(d)==="work"?"Work Time":"Break Time"),3),o("div",{class:"timer-display",role:"timer","aria-label":`${s(d)==="work"?"Work":"Break"} timer: ${s(i).formattedTime} remaining`},[n(u(s(i).formattedTime)+" ",1),o("div",{class:g(["progress-bar",s(d)]),style:I({width:`${s(T)}%`})},null,6)],8,K),o("div",x,[s(r)?(l(),a("button",{key:1,class:"control-button secondary",onClick:e[1]||(e[1]=(...m)=>s(i).pause&&s(i).pause(...m)),"aria-label":"Pause timer"},e[6]||(e[6]=[o("span",{class:"button-icon","aria-hidden":"true"},"‚è∏",-1),n(" Pause ")]))):(l(),a("button",{key:0,class:"control-button primary",onClick:e[0]||(e[0]=(...m)=>s(i).start&&s(i).start(...m)),"aria-label":"Start timer"},e[5]||(e[5]=[o("span",{class:"button-icon","aria-hidden":"true"},"‚ñ∂",-1),n(" Start ")]))),o("button",{class:"control-button secondary",onClick:e[2]||(e[2]=(...m)=>s(i).reset&&s(i).reset(...m)),"aria-label":"Reset timer"},e[7]||(e[7]=[o("span",{class:"button-icon","aria-hidden":"true"},"‚Ü∫",-1),n(" Reset ")])),o("button",{class:"control-button secondary",onClick:e[3]||(e[3]=(...m)=>s(i).toggleMode&&s(i).toggleMode(...m)),"aria-label":s(d)==="work"?"Switch to break timer":"Switch to work timer"},[e[8]||(e[8]=o("span",{class:"button-icon","aria-hidden":"true"},"‚áÑ",-1)),n(" "+u(s(d)==="work"?"Take Break":"Work Time"),1)],8,F)]),f(` 
      <div class="keyboard-shortcuts" role="region" aria-label="Keyboard shortcuts">
        <p>Keyboard Shortcuts:</p>
        <ul>
          <li>Space - Start/Pause</li>
          <li>R - Reset</li>
          <li>B - Toggle Break</li>
        </ul>
      </div> `),s(h)?(l(),a("div",V,[e[11]||(e[11]=o("div",{class:"stats-header"},[o("span",{class:"stats-icon","aria-hidden":"true"},"üìä"),o("h2",null,"Your Progress")],-1)),o("div",W,[o("p",null,[e[9]||(e[9]=o("span",{class:"stats-icon","aria-hidden":"true"},"üéØ",-1)),n(" Completed Sessions: "+u(s(h).completedSessions),1)]),o("p",null,[e[10]||(e[10]=o("span",{class:"stats-icon","aria-hidden":"true"},"‚è±",-1)),n(" Total Focus Time: "+u(s(i).formattedTotalTime),1)])])])):f("v-if",!0),s(r)?(l(),a("div",U,[o("p",null,u(s(d)==="work"?"Focus Time!":"Take a Break!"),1),e[12]||(e[12]=o("img",{src:D,alt:"My Melody Dancing",loading:"lazy"},null,-1))])):f("v-if",!0)]))]))}}),q=C($,[["__scopeId","data-v-d224a1cf"]]);export{q as default};
