import{d as G,k as J,y as Q,r as a,w as W,h as X,j as Z,c as o,t as F,g as m,A as D,a as t,q as ee,f as w,v as E,B as y,n as $,F as U,C as z,p as te,o as n,e as L}from"./app-DJtXMlp-.js";const le={key:0,class:"error-toast"},se={key:1,class:"loading-overlay"},ae={key:2,class:"modal-overlay"},oe={class:"modal-content"},ne={class:"modal-actions"},ie={key:3,class:"modal-overlay"},de={class:"modal-content edit-modal"},ue={key:4,class:"modal-overlay"},re={class:"modal-content edit-modal"},ce={class:"content"},ve={class:"folders-section"},me={class:"folder-list"},ke=["onClick"],pe={class:"folder-actions"},fe=["onClick"],ye=["onClick"],be={class:"add-folder"},ge={class:"tasks-section"},_e={class:"add-task"},he={class:"tasks-list"},Ce={class:"task-content"},Te=["checked","onChange"],Fe={class:"task-title"},we={class:"task-actions"},Ee=["onClick"],De=["onClick"],Ie=G({__name:"Tasks",setup($e){const i=J(),{tasks:N,folders:I,loading:O,error:q}=Q(i),b=a(""),g=a(""),r=a(null),k=a(""),_=a(""),p=a(null),c=a(""),f=a(null),v=a(""),h=a(null),T=a(!1),d=a(null),V=()=>{const e=new Date().getHours();e>=5&&e<12?(_.value="morning",k.value="url(/public/assets/bgsky.jpg)"):e>=12&&e<13?(_.value="noon",k.value="url(/public/assets/sunsetbg.jpg)"):e>=13&&e<17?(_.value="afternoon",k.value="url(/public/assets/bgsky.jpg)"):e>=17&&e<21?(_.value="evening",k.value="url(/public/assets/sunsetbg.jpg)"):(_.value="night",k.value="url(/public/assets/moonbg.gif)")};W(()=>q.value,e=>{e&&(d.value=e,setTimeout(()=>{d.value=null,i.$patch({error:null})},5e3))});const A=(e,l,u)=>{h.value={id:e,type:l,name:u},T.value=!0},H=async()=>{if(h.value)try{const{id:e,type:l}=h.value;l==="task"?await i.deleteTask(e):await i.deleteFolder(e),T.value=!1,h.value=null}catch(e){d.value=e instanceof Error?e.message:"An error occurred"}},j=async()=>{if(b.value.trim())try{await i.addTask(b.value,r.value),b.value=""}catch(e){d.value=e instanceof Error?e.message:"Failed to add task"}},x=async()=>{if(g.value.trim())try{await i.addFolder(g.value,"task"),g.value=""}catch(e){d.value=e instanceof Error?e.message:"Failed to add folder"}},P=e=>{const l=N.value.find(u=>u.id===e);l&&(p.value=e,c.value=l.title)},K=async()=>{if(!(!p.value||!c.value.trim()))try{await i.editTask(p.value,{title:c.value}),p.value=null,c.value=""}catch(e){d.value=e instanceof Error?e.message:"Failed to edit task"}},S=()=>{p.value=null,c.value=""},R=e=>{const l=I.value.find(u=>u.id===e);l&&(f.value=e,v.value=l.name)},B=async()=>{if(!(!f.value||!v.value.trim()))try{await i.editFolder(f.value,{name:v.value.trim(),type:"task"}),f.value=null,v.value=""}catch(e){d.value=e instanceof Error?e.message:"Failed to edit folder"}},M=()=>{f.value=null,v.value=""},Y=X(()=>{const e=N.value.filter(l=>!l.deleted);return r.value?e.filter(l=>l.folderId===r.value):e});return Z(async()=>{setInterval(V,6e4),V();try{await Promise.all([i.fetchTasks(),i.fetchFolders()])}catch(e){d.value=e instanceof Error?e.message:"Failed to fetch data"}}),(e,l)=>{var u;return n(),o("div",{class:"tasks-container",style:te({backgroundImage:k.value})},[d.value?(n(),o("div",le,F(d.value),1)):m("v-if",!0),D(O)?(n(),o("div",se,l[6]||(l[6]=[t("div",{class:"spinner"},null,-1),ee(" Loading... ")]))):m("v-if",!0),T.value?(n(),o("div",ae,[t("div",oe,[l[7]||(l[7]=t("h3",null,"Confirm Delete",-1)),t("p",null,'Are you sure you want to delete "'+F((u=h.value)==null?void 0:u.name)+'"?',1),t("div",ne,[t("button",{class:"primary-button",onClick:H},"Yes, Delete"),t("button",{class:"secondary-button",onClick:l[0]||(l[0]=s=>T.value=!1)},"Cancel")])])])):m("v-if",!0),p.value?(n(),o("div",ie,[t("div",de,[l[8]||(l[8]=t("h3",null,"Edit Task",-1)),w(t("input",{"onUpdate:modelValue":l[1]||(l[1]=s=>c.value=s),onKeyup:[y(K,["enter"]),y(S,["esc"])],class:"edit-input",placeholder:"Task title",ref:"editTaskInput",autofocus:""},null,544),[[E,c.value]]),t("div",{class:"modal-actions"},[t("button",{class:"primary-button",onClick:K},"Save"),t("button",{class:"secondary-button",onClick:S},"Cancel")])])])):m("v-if",!0),f.value?(n(),o("div",ue,[t("div",re,[l[9]||(l[9]=t("h3",null,"Edit Folder",-1)),w(t("input",{"onUpdate:modelValue":l[2]||(l[2]=s=>v.value=s),onKeyup:[y(B,["enter"]),y(M,["esc"])],class:"edit-input",placeholder:"Folder name",ref:"editFolderInput",autofocus:""},null,544),[[E,v.value]]),t("div",{class:"modal-actions"},[t("button",{class:"primary-button",onClick:B},"Save"),t("button",{class:"secondary-button",onClick:M},"Cancel")])])])):m("v-if",!0),t("div",ce,[t("div",ve,[l[11]||(l[11]=t("h2",null,"Folders",-1)),t("div",me,[t("button",{class:$(["folder-item",{active:!r.value}]),onClick:l[3]||(l[3]=s=>r.value=null)},l[10]||(l[10]=[t("p",null,"All Tasks",-1)]),2),(n(!0),o(U,null,z(D(I).filter(s=>s.type==="task"),s=>(n(),o("button",{key:s.id??"",class:$(["folder-item",{active:r.value===s.id}]),onClick:C=>r.value=s.id??null},[t("p",null,F(s.name),1),t("div",pe,[s.id?(n(),o("button",{key:0,class:"icon-button edit-button",onClick:L(C=>R(s.id??""),["stop"])}," ✏️ ",8,fe)):m("v-if",!0),s.id?(n(),o("button",{key:1,class:"icon-button delete-button",onClick:L(C=>s.id&&A(s.id,"folder",s.name),["stop"])}," 🗑️ ",8,ye)):m("v-if",!0)])],10,ke))),128))]),t("div",be,[w(t("input",{"onUpdate:modelValue":l[4]||(l[4]=s=>g.value=s),placeholder:"New folder name",onKeyup:y(x,["enter"])},null,544),[[E,g.value]]),t("button",{class:"primary-button",onClick:x},"Add Folder")])]),t("div",ge,[t("div",_e,[w(t("input",{"onUpdate:modelValue":l[5]||(l[5]=s=>b.value=s),placeholder:"New task",onKeyup:y(j,["enter"])},null,544),[[E,b.value]]),t("button",{class:"primary-button",onClick:j},"Add Task")]),t("div",he,[(n(!0),o(U,null,z(Y.value,s=>(n(),o("div",{key:s.id??"",class:$(["task-item",{completed:s.completed}])},[t("div",Ce,[t("input",{type:"checkbox",checked:s.completed,onChange:C=>s.id&&D(i).editTask(s.id,{completed:!s.completed})},null,40,Te),t("span",Fe,F(s.title),1),t("div",we,[t("button",{class:"icon-button edit-button",onClick:C=>s.id&&P(s.id)}," ✏️ ",8,Ee),t("button",{class:"icon-button delete-button",onClick:C=>s.id&&A(s.id,"task",s.title)}," 🗑️ ",8,De)])])],2))),128))])])])],4)}}});export{Ie as default};
